<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutri-Mind | Privacy-First AI</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Font: Plus Jakarta Sans -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #F3F4F6; }
        .glass-panel { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .animate-fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        .animate-slide-up { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(40px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        input[type="file"] { display: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==========================================
        // ðŸ”’ ADMIN CONFIGURATION
        // PASTE YOUR API KEY HERE. IT WILL BE HIDDEN FROM THE UI.
        const PRIVATE_API_KEY = ""; 
        // ==========================================

        // --- SHARED COMPONENTS ---

        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => { lucide.createIcons(); }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        // --- VIEW COMPONENTS ---

        const HomeView = ({ 
            query, 
            setQuery, 
            file, 
            setFile, 
            onAnalyze 
        }) => {
            const fileInputRef = useRef(null);

            const handleFileSelect = (e) => {
                if (e.target.files && e.target.files[0]) {
                    setFile(e.target.files[0]);
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 relative bg-[#FAFAFA]">
                    <div className="w-full max-w-lg animate-fade-in z-10">
                        <div className="text-center mb-12">
                            <div className="inline-flex items-center justify-center w-20 h-20 rounded-[2rem] bg-black text-white shadow-2xl shadow-gray-200 mb-6 rotate-3 hover:rotate-0 transition-transform duration-500">
                                <Icon name="scan-line" size={36} />
                            </div>
                            <h1 className="text-5xl font-extrabold text-gray-900 tracking-tight mb-3">Nutri-Mind</h1>
                            <p className="text-gray-500 text-lg font-medium">Privacy-First Contextual AI</p>
                        </div>

                        {/* Search Container */}
                        <div className="bg-white p-3 rounded-[2rem] shadow-xl shadow-gray-100 border border-gray-100 transition-transform hover:scale-[1.01] duration-300">
                            
                            {/* Image Preview Area */}
                            {file && (
                                <div className="mx-2 mt-2 mb-3 px-4 py-3 bg-gray-50 rounded-2xl flex items-center justify-between border border-gray-100 animate-fade-in">
                                    <div className="flex items-center gap-3 overflow-hidden">
                                        <div className="w-10 h-10 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400">
                                            <Icon name="image" size={20} />
                                        </div>
                                        <div className="flex flex-col">
                                            <span className="text-xs font-bold text-gray-400 uppercase tracking-wider">Attached</span>
                                            <span className="text-sm font-semibold text-gray-800 truncate max-w-[150px]">{file.name}</span>
                                        </div>
                                    </div>
                                    <button onClick={() => setFile(null)} className="w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-sm text-gray-400 hover:text-red-500 transition-colors">
                                        <Icon name="x" size={16} />
                                    </button>
                                </div>
                            )}

                            {/* Input Area */}
                            <div className="flex items-center gap-3 pl-4 pr-2 pb-1">
                                <input 
                                    type="text" 
                                    className="flex-1 py-4 text-lg outline-none text-gray-900 placeholder:text-gray-300 font-medium bg-transparent"
                                    placeholder={file ? "Add context (e.g. 'Is this keto?')" : "Type a food or scan..."}
                                    value={query}
                                    onChange={(e) => setQuery(e.target.value)}
                                    onKeyDown={(e) => e.key === 'Enter' && onAnalyze()}
                                />
                                
                                {/* Controls */}
                                <div className="flex gap-2">
                                    <input 
                                        type="file" 
                                        accept="image/*" 
                                        ref={fileInputRef} 
                                        onChange={handleFileSelect} 
                                    />
                                    <button 
                                        onClick={() => fileInputRef.current.click()}
                                        className={`p-4 rounded-2xl transition-all duration-200 ${file ? 'bg-black text-white' : 'bg-gray-100 text-gray-500 hover:bg-gray-200'}`}
                                        title="Upload Image"
                                    >
                                        <Icon name="camera" size={24} />
                                    </button>
                                    <button 
                                        onClick={onAnalyze}
                                        className="p-4 bg-blue-600 hover:bg-blue-700 text-white rounded-2xl shadow-lg shadow-blue-200 transition-all duration-200 active:scale-95"
                                    >
                                        <Icon name="arrow-right" size={24} />
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Footer Badges */}
                        <div className="mt-12 flex justify-center gap-8 text-xs font-bold tracking-widest text-gray-300 uppercase">
                            <span className="flex items-center gap-2 hover:text-gray-400 transition-colors cursor-help" title="We do not store images or text">
                                <Icon name="shield" size={14}/> 
                                Zero Data Stored
                            </span>
                            <span className="flex items-center gap-2 hover:text-gray-400 transition-colors cursor-help" title="AI infers intent from the product itself">
                                <Icon name="brain-circuit" size={14}/> 
                                Context Aware
                            </span>
                        </div>
                    </div>
                </div>
            );
        };

        const ScanningView = () => (
            <div className="min-h-screen bg-black flex flex-col items-center justify-center text-white relative overflow-hidden">
                <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-gray-800 via-black to-black opacity-50"></div>
                <div className="relative z-10 text-center px-6">
                    <div className="relative w-24 h-24 mx-auto mb-10">
                        <div className="absolute inset-0 border-t-4 border-white rounded-full animate-spin"></div>
                        <div className="absolute inset-2 border-r-4 border-gray-600 rounded-full animate-spin" style={{animationDuration: '1.5s'}}></div>
                        <div className="absolute inset-4 border-b-4 border-gray-800 rounded-full animate-spin" style={{animationDuration: '2s'}}></div>
                    </div>
                    <h2 className="text-3xl font-bold animate-pulse tracking-tight">Analyzing Composition</h2>
                    <p className="text-gray-400 mt-4 text-sm font-mono uppercase tracking-widest">Inferring Health Context...</p>
                </div>
            </div>
        );

        const ResultView = ({ result, onBack }) => {
            if (!result) return null;
            
            // Design System based on Verdict
            const theme = {
                green: { 
                    header: "bg-[#10B981]", 
                    text: "text-[#064E3B]", 
                    accent: "bg-[#D1FAE5]", 
                    icon: "check-circle-2" 
                },
                yellow: { 
                    header: "bg-[#F59E0B]", 
                    text: "text-[#78350F]", 
                    accent: "bg-[#FEF3C7]", 
                    icon: "alert-circle" 
                },
                red: { 
                    header: "bg-[#EF4444]", 
                    text: "text-[#7F1D1D]", 
                    accent: "bg-[#FEE2E2]", 
                    icon: "x-circle" 
                }
            }[result.color] || theme.yellow;

            return (
                <div className="min-h-screen bg-gray-50 font-sans">
                    {/* Immersive Header */}
                    <div className={`${theme.header} min-h-[30vh] relative flex flex-col p-6 transition-colors duration-500`}>
                        <button 
                            onClick={onBack} 
                            className="absolute top-6 left-6 p-2 bg-black/10 hover:bg-black/20 text-white rounded-full backdrop-blur-md transition-colors"
                        >
                            <Icon name="arrow-left" size={24} />
                        </button>
                        
                        <div className="mt-auto mb-16 max-w-2xl mx-auto w-full text-white">
                            <div className="flex items-center gap-2 mb-3 opacity-90">
                                <span className="text-xs font-bold uppercase tracking-widest bg-black/20 px-2 py-1 rounded-md backdrop-blur-sm">
                                    Detected
                                </span>
                            </div>
                            <h1 className="text-4xl md:text-5xl font-extrabold tracking-tight leading-tight">
                                {result.product_name}
                            </h1>
                        </div>
                    </div>

                    {/* Content Card (Floating) */}
                    <div className="-mt-12 px-4 pb-12 max-w-2xl mx-auto relative z-10 animate-slide-up">
                        <div className="bg-white rounded-[2rem] shadow-xl shadow-gray-200/50 overflow-hidden">
                            
                            {/* Verdict Header */}
                            <div className="p-8 border-b border-gray-100">
                                <div className="flex items-center justify-between mb-4">
                                    <div className="flex items-center gap-2 text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full">
                                        <Icon name="sparkles" size={12} />
                                        <span>Context: {result.inferred_intent}</span>
                                    </div>
                                    <span className={`${theme.text} bg-opacity-20 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider`}>
                                        Verdict: {result.verdict}
                                    </span>
                                </div>
                                
                                <p className="text-xl text-gray-800 leading-relaxed font-medium">
                                    {result.summary}
                                </p>
                            </div>

                            {/* Pros & Cons Grid */}
                            <div className="grid grid-cols-1 md:grid-cols-2 border-b border-gray-100">
                                {/* The Good */}
                                <div className="p-6 bg-emerald-50/50 border-b md:border-b-0 md:border-r border-emerald-100">
                                    <div className="flex items-center gap-2 mb-4 text-emerald-800">
                                        <Icon name="thumbs-up" size={18} />
                                        <h3 className="text-sm font-bold uppercase tracking-wider">The Good</h3>
                                    </div>
                                    <ul className="space-y-3">
                                        {result.positives && result.positives.map((item, i) => (
                                            <li key={i} className="flex items-start gap-2 text-sm text-emerald-900/80 leading-snug">
                                                <span className="mt-1 w-1.5 h-1.5 rounded-full bg-emerald-400 shrink-0"></span>
                                                {item}
                                            </li>
                                        ))}
                                    </ul>
                                </div>

                                {/* The Bad */}
                                <div className="p-6 bg-rose-50/50 border-rose-100">
                                    <div className="flex items-center gap-2 mb-4 text-rose-800">
                                        <Icon name="alert-triangle" size={18} />
                                        <h3 className="text-sm font-bold uppercase tracking-wider">Watch Out</h3>
                                    </div>
                                    <ul className="space-y-3">
                                        {result.negatives && result.negatives.map((item, i) => (
                                            <li key={i} className="flex items-start gap-2 text-sm text-rose-900/80 leading-snug">
                                                <span className="mt-1 w-1.5 h-1.5 rounded-full bg-rose-400 shrink-0"></span>
                                                {item}
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            </div>

                            {/* Science Box */}
                            <div className="p-8">
                                <div className="bg-gray-900 rounded-2xl p-6 text-white relative overflow-hidden group">
                                    <div className="absolute top-0 right-0 p-8 opacity-5 transform group-hover:scale-110 transition-transform duration-700">
                                        <Icon name="microscope" size={100} />
                                    </div>
                                    <div className="relative z-10">
                                        <div className="flex items-center gap-2 mb-3 text-blue-400">
                                            <Icon name="flask-conical" size={18} />
                                            <span className="text-xs font-bold uppercase tracking-widest">Scientific Insight</span>
                                        </div>
                                        <p className="text-gray-300 leading-relaxed text-sm">
                                            {result.key_insight}
                                        </p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---

        const App = () => {
            const [query, setQuery] = useState("");
            const [file, setFile] = useState(null);
            const [loading, setLoading] = useState(false);
            const [view, setView] = useState("home"); 
            const [result, setResult] = useState(null);
            
            const apiKey = PRIVATE_API_KEY; 

            const handleAnalyze = async () => {
                if (!query && !file) {
                    alert("Please enter text or upload an image to start.");
                    return;
                }

                setLoading(true);
                setView("scanning");

                let base64Data = null;
                let mimeType = null;

                if (file) {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onloadend = async () => {
                        base64Data = reader.result.split(',')[1];
                        mimeType = file.type;
                        processGeminiCall(base64Data, mimeType);
                    };
                } else {
                    processGeminiCall(null, null);
                }
            };

            const processGeminiCall = async (base64Data, mimeType) => {
                if (!apiKey || apiKey === "") {
                    console.warn("NO API KEY FOUND. Please edit index.html and paste your key in const PRIVATE_API_KEY");
                    setTimeout(() => simulateAnalysis(query || (file ? "Image Scan" : "")), 2500);
                } else {
                    await analyzeWithGemini(base64Data, mimeType, query);
                }
            };

            const analyzeWithGemini = async (base64Data, mimeType, textQuery) => {
                try {
                    let userPrompt = `Analyze the provided input (Image and/or Text).\n`;
                    if (textQuery) userPrompt += `USER CONTEXT/QUESTION: "${textQuery}"\n`;
                    userPrompt += `
                        1. Identify the food product.
                        2. Infer the User's INTENT.
                        3. Provide a strict nutritional verdict with Pros and Cons.
                    `;

                    const systemInstruction = `
                        You are a strict, privacy-focused nutritionist AI.
                        Return JSON ONLY. No markdown.
                        Structure:
                        {
                            "product_name": "String (Max 5 words)",
                            "inferred_intent": "String (1-3 words)",
                            "verdict": "Healthy/Moderate/Avoid",
                            "color": "green/yellow/red",
                            "summary": "String (Conversational, max 2 sentences)",
                            "positives": ["Short point 1", "Short point 2"],
                            "negatives": ["Short point 1", "Short point 2"],
                            "key_insight": "String (Scientific fact, max 2 sentences)"
                        }
                    `;

                    const parts = [{ text: userPrompt + "\n" + systemInstruction }];
                    if (base64Data) {
                        parts.push({ inlineData: { mimeType: mimeType, data: base64Data } });
                    }

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ parts: parts }]
                        })
                    });

                    const data = await response.json();
                    
                    if (data.error) throw new Error(data.error.message);

                    const text = data.candidates[0].content.parts[0].text.replace(/```json/g, '').replace(/```/g, '');
                    setResult(JSON.parse(text));
                    setView("results");

                } catch (error) {
                    console.error("AI Error", error);
                    simulateAnalysis("Error Fallback");
                } finally {
                    setLoading(false);
                }
            };

            const simulateAnalysis = (input) => {
                const safeInput = (input || "").toLowerCase();
                const isHealthy = safeInput.includes("yogurt") || safeInput.includes("salad") || safeInput.includes("apple") || safeInput.includes("vegan");
                const hasQuestion = safeInput.includes("?");

                setResult({
                    product_name: file ? "Scanned Item (Demo)" : (input.length > 20 ? "Complex Query" : input),
                    inferred_intent: hasQuestion ? "Specific Answer" : (isHealthy ? "Wellness" : "Indulgence"),
                    verdict: isHealthy ? "Excellent" : "Moderate",
                    color: isHealthy ? "green" : "yellow",
                    summary: isHealthy 
                        ? "This is a nutrient-dense choice that supports sustained energy levels." 
                        : "Processed ingredients detected. It's fine occasionally, but watch the sugar content.",
                    positives: isHealthy 
                        ? ["High in vitamins", "Low glycemic index", "Natural ingredients"]
                        : ["Quick energy source", "Convenient packaging"],
                    negatives: isHealthy
                        ? ["Short shelf life", "Can be expensive"]
                        : ["High added sugar", "Contains preservatives", "Low satiety"],
                    key_insight: "Simulation Mode: Edit the code and add your API Key to get real-time AI analysis."
                });
                setLoading(false);
                setView("results");
            };

            return (
                <div>
                    {view === "home" && (
                        <HomeView 
                            query={query} 
                            setQuery={setQuery} 
                            file={file} 
                            setFile={setFile} 
                            onAnalyze={handleAnalyze}
                        />
                    )}
                    {view === "scanning" && <ScanningView />}
                    {view === "results" && (
                        <ResultView 
                            result={result} 
                            onBack={() => { 
                                setView("home"); 
                                setFile(null); 
                                setQuery(""); 
                            }} 
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>